SELECT D.jDS, COUNT(*) AS q
FROM f_dw_ventes V, f_dw_date D
WHERE V.fkDate=D.dateTicket
GROUP BY D.jDS
ORDER BY q desc;

SELECT R.dayOfWeek, AVG(R.quantity) AS q
FROM
(
  SELECT D.dateTicket, D.jDS AS dayOfWeek, COUNT(*) AS quantity 
  FROM f_dw_ventes V, f_dw_date D
  WHERE V.fkDate = D.dateTicket
  GROUP BY D.dateTicket, D.jDS
) R
GROUP BY R.dayOfWeek
HAVING R.dayOfWeek != 6
ORDER BY q DESC;


CREATE VIEW VentesFonctionJour
AS
SELECT D.jDS, COUNT(*) AS q
FROM f_dw_ventes V, f_dw_date D
WHERE V.fkDate=D.dateTicket
GROUP BY D.jDS
ORDER BY q desc;

SELECT * FROM VentesFonctionJour;

CREATE VIEW MoyenneVentesFonctionJour
AS
SELECT R.dayOfWeek, AVG(R.quantity) AS q
FROM
(
  SELECT D.dateTicket, D.jDS AS dayOfWeek, COUNT(*) AS quantity 
  FROM f_dw_ventes V, f_dw_date D
  WHERE V.fkDate = D.dateTicket
  GROUP BY D.dateTicket, D.jDS
) R
GROUP BY R.dayOfWeek
HAVING R.dayOfWeek != 6
ORDER BY q DESC;

CREATE VIEW MoyenneVentes(moy) AS
SELECT AVG(q) 
FROM MoyenneVentesFonctionJour;

SELECT * FROM MoyenneVentes;


CREATE VIEW MoyenneVentesSamedi
AS
SELECT q FROM(
  SELECT R.dayOfWeek, AVG(R.quantity) AS q
  FROM
  (
    SELECT D.dateTicket, D.jDS AS dayOfWeek, COUNT(*) AS quantity 
    FROM f_dw_ventes V, f_dw_date D
    WHERE V.fkDate = D.dateTicket
    GROUP BY D.dateTicket, D.jDS
  ) R
  GROUP BY R.dayOfWeek
  HAVING R.dayOfWeek = 6
  ORDER BY q DESC
);

SELECT * FROM MoyenneVentesSamedi;

SELECT q/moy AS ratioSamediParRapportSemaine FROM(
  SELECT * 
  FROM MoyenneVentes,
  MoyenneVentesSamedi
);

SELECT M.rayonnage AS r1, COUNT(*) AS q1
FROM f_dw_ventes V, f_dw_magasin M
WHERE V.fkMagasin=M.magasin
GROUP BY M.rayonnage;

SELECT M.rayonnage AS r2, COUNT(*) AS q2
FROM f_dw_magasin M
GROUP BY M.rayonnage; 


SELECT r1 AS rayonnage, q1 AS Ventes, q2 AS Mag, ROUND(q1/q2) AS VentesParMag FROM
(
  SELECT M.rayonnage AS r1, COUNT(*) AS q1
  FROM f_dw_ventes V, f_dw_magasin M
  WHERE V.fkMagasin=M.magasin
  GROUP BY M.rayonnage 
),
(
  SELECT M.rayonnage AS r2, COUNT(*) AS q2
  FROM f_dw_magasin M
  GROUP BY M.rayonnage
)
WHERE r1=r2
ORDER BY VentesParMag DESC;


SELECT M.rayonBS AS r1, COUNT(*) AS q1
FROM f_dw_ventes V, f_dw_magasin M
WHERE V.fkMagasin=M.magasin
GROUP BY M.rayonBS;

SELECT M.rayonBS AS r2, COUNT(*) AS q2
FROM f_dw_magasin M
GROUP BY M.rayonBS; 

SELECT r1 AS rayonnage, q1 AS Ventes, q2 AS Mag, ROUND(q1/q2) AS VentesParMag FROM
(
  SELECT M.rayonBS AS r1, COUNT(*) AS q1
  FROM f_dw_ventes V, f_dw_magasin M
  WHERE V.fkMagasin=M.magasin
  GROUP BY M.rayonBS
),
(
  SELECT M.rayonBS AS r2, COUNT(*) AS q2
  FROM f_dw_magasin M
  GROUP BY M.rayonBS
)
WHERE r1=r2
ORDER BY VentesParMag DESC;


SELECT M.rayonBS AS r1, COUNT(*) AS q1
FROM f_dw_ventes V, f_dw_magasin M
WHERE V.fkMagasin=M.magasin AND M.rayonnage = 'A'
GROUP BY M.rayonBS;

SELECT M.rayonBS AS r2, COUNT(*) AS q2
FROM f_dw_magasin M
WHERE M.rayonnage = 'A'
GROUP BY M.rayonBS; 

SELECT r1 AS rayonnage, q1 AS Ventes, q2 AS Mag, ROUND(q1/q2) AS VentesParMagA FROM
(
  SELECT M.rayonBS AS r1, COUNT(*) AS q1
  FROM f_dw_ventes V, f_dw_magasin M
  WHERE V.fkMagasin=M.magasin AND M.rayonnage = 'A'
  GROUP BY M.rayonBS
),
(
  SELECT M.rayonBS AS r2, COUNT(*) AS q2
  FROM f_dw_magasin M
  GROUP BY M.rayonBS
)
WHERE r1=r2
ORDER BY VentesParMagA DESC;


SELECT AVG(R.quantity) AS q
FROM
(
  SELECT P.iSBN, COUNT(*) AS quantity 
  FROM f_dw_ventes V, f_dw_produit P
  WHERE V.fkProduit = P.iSBN
  GROUP BY P.iSBN
) R;
